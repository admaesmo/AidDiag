{
  "info": {
    "name": "AidDiag Parte 1",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "Colecci\u00f3n para flujos principales del MVP"
  },
  "item": [
    {
      "name": "Auth - Sign Up",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"{{user_admin_email}}\",\n  \"password\": \"{{user_admin_pass}}\",\n  \"role\": \"Admin\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/v1/auth/signup",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "v1",
            "auth",
            "signup"
          ]
        }
      }
    },
    {
      "name": "Auth - Sign In (Password)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"{{user_admin_email}}\",\n  \"password\": \"{{user_admin_pass}}\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/v1/auth/signin",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "v1",
            "auth",
            "signin"
          ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "const data = pm.response.json();",
              "if (data.token) {",
              "  pm.environment.set('bearer_token', data.token);",
              "  if (data.expires_at) { pm.environment.set('token_expires_at', data.expires_at); }",
              "}"
            ]
          }
        }
      ]
    },
    {
      "name": "Auth - Me",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{bearer_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/v1/auth/me",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "v1",
            "auth",
            "me"
          ]
        }
      }
    },
    {
      "name": "Auth - Assign Role",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{bearer_token}}",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"user_id\": \"{{professional_user_id}}\",\n  \"role\": \"Profesional\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/v1/auth/assign-role",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "v1",
            "auth",
            "assign-role"
          ]
        }
      }
    },
    {
      "name": "Auth - Enable MFA",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{bearer_token}}",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"user_id\": \"{{professional_user_id}}\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/v1/auth/mfa/enable",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "v1",
            "auth",
            "mfa",
            "enable"
          ]
        }
      }
    },
    {
      "name": "Auth - Password Reset",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{bearer_token}}",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"{{user_prof_email}}\",\n  \"new_password\": \"{{user_prof_pass}}\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/v1/auth/password/reset",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "v1",
            "auth",
            "password",
            "reset"
          ]
        }
      }
    },
    {
      "name": "Symptoms - Create",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{bearer_token}}",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"patient_id\": \"{{patient_id}}\",\n  \"payload\": {\n    \"symptoms\": [\n      \"fever\",\n      \"cough\"\n    ]\n  }\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/v1/symptoms",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "v1",
            "symptoms"
          ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "const data = pm.response.json();",
              "if (data.id) { pm.environment.set('symptom_entry_id', data.id); }"
            ]
          }
        }
      ]
    },
    {
      "name": "Predict",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{bearer_token}}",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"patient_id\": \"{{patient_id}}\",\n  \"symptom_entry_id\": \"{{symptom_entry_id}}\",\n  \"model_version\": \"{{model_version}}\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/v1/predict",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "v1",
            "predict"
          ]
        }
      }
    },
    {
      "name": "Predictions - List",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{bearer_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/v1/predictions?patient_id={{patient_id}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "v1",
            "predictions"
          ],
          "query": [
            {
              "key": "patient_id",
              "value": "{{patient_id}}"
            }
          ]
        }
      }
    },
    {
      "name": "Cases - List",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{bearer_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/v1/cases?assigned_to={{professional_user_id}}&status_filter=open",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "v1",
            "cases"
          ],
          "query": [
            {
              "key": "assigned_to",
              "value": "{{professional_user_id}}"
            },
            {
              "key": "status_filter",
              "value": "open"
            }
          ]
        }
      }
    },
    {
      "name": "Cases - Patch",
      "request": {
        "method": "PATCH",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{bearer_token}}",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"status\": \"in_progress\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/v1/cases/{{case_id}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "v1",
            "cases",
            "{{case_id}}"
          ]
        }
      }
    },
    {
      "name": "Audit - Create Event",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{bearer_token}}",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"action\": \"model.predict\",\n  \"entity\": \"prediction\",\n  \"entity_id\": \"{{symptom_entry_id}}\",\n  \"meta\": {\n    \"source\": \"postman\"\n  }\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/v1/audit/events",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "v1",
            "audit",
            "events"
          ]
        }
      }
    }
  ]
}